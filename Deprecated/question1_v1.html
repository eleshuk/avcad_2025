<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data cleaning â€“ AVCAD 2025 Dashboard</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">AVCAD 2025 Dashboard</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.qmd"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link active" data-scroll-target="#data-exploration">Data exploration</a></li>
  <li><a href="#one-way-anova-for-soilbd-across-each-management-variable" id="toc-one-way-anova-for-soilbd-across-each-management-variable" class="nav-link" data-scroll-target="#one-way-anova-for-soilbd-across-each-management-variable">One-way ANOVA for SoilBD across each management variable</a></li>
  <li><a href="#tukey-hsd-post-hoc-tests-for-significant-anovas" id="toc-tukey-hsd-post-hoc-tests-for-significant-anovas" class="nav-link" data-scroll-target="#tukey-hsd-post-hoc-tests-for-significant-anovas">Tukey HSD Post Hoc Tests for Significant ANOVAs</a></li>
  <li><a href="#stratified-anova-and-boxplots-by-country" id="toc-stratified-anova-and-boxplots-by-country" class="nav-link" data-scroll-target="#stratified-anova-and-boxplots-by-country">Stratified ANOVA and Boxplots by Country</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data cleaning</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="96d3cd27-973d-414c-addf-4a4c2c89de59" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.anova <span class="im">import</span> anova_lm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.multicomp <span class="im">import</span> pairwise_tukeyhsd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="99c7f36b-616b-4476-88ea-c448b051ee64" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Just load the sheet directly as a DataFrame</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"SoilHealthDB_V2.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">'Sheet1'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Strip whitespace from column names</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename for clarity and consistency (only those that exist)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>rename_map <span class="op">=</span> {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CoverCropGroup'</span>: <span class="st">'CoverCropGroup'</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Tillage_Top_T'</span>: <span class="st">'Tillage'</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Rotation_Top_T'</span>: <span class="st">'Rotation'</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GrainCropGroup'</span>: <span class="st">'GrainCropGroup'</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Grazing_Top_T'</span>: <span class="st">'Grazing'</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SoilBD'</span>: <span class="st">'SoilBD'</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{k: v <span class="cf">for</span> k, v <span class="kw">in</span> rename_map.items() <span class="cf">if</span> k <span class="kw">in</span> df.columns})</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only relevant columns that are present</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>needed_columns <span class="op">=</span> [<span class="st">'CoverCropGroup'</span>, <span class="st">'Tillage'</span>, <span class="st">'Rotation'</span>, <span class="st">'GrainCropGroup'</span>, <span class="st">'Grazing'</span>, <span class="st">'SoilBD'</span>]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[col <span class="cf">for</span> col <span class="kw">in</span> needed_columns <span class="cf">if</span> col <span class="kw">in</span> df.columns]]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows where SoilBD is missing</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'SoilBD'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-exploration">Data exploration</h2>
<div id="4c31748c-cdd5-4bc1-a988-a79f12435821" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the variables to plot (only those that are present in your DataFrame)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>management_vars <span class="op">=</span> [<span class="st">'CoverCropGroup'</span>, <span class="st">'Tillage'</span>, <span class="st">'GrainCropGroup'</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>num_vars <span class="op">=</span> <span class="bu">len</span>(management_vars)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span>num_vars, figsize<span class="op">=</span>(<span class="dv">6</span> <span class="op">*</span> num_vars, <span class="dv">5</span>), constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each variable</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, var <span class="kw">in</span> <span class="bu">enumerate</span>(management_vars):</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>df, x<span class="op">=</span>var, y<span class="op">=</span><span class="st">'SoilBD'</span>, ax<span class="op">=</span>axes[i])</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    axes[i].set_title(<span class="ss">f"SoilBD by </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    axes[i].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    axes[i].set_xlabel(<span class="st">""</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    axes[i].set_ylabel(<span class="st">"Soil Bulk Density"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the full row of plots</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="question1_v1_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="one-way-anova-for-soilbd-across-each-management-variable" class="level2">
<h2 class="anchored" data-anchor-id="one-way-anova-for-soilbd-across-each-management-variable">One-way ANOVA for SoilBD across each management variable</h2>
<div id="e37ad694-4e42-4173-9be5-ca4aeea9e18c" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.anova <span class="im">import</span> anova_lm</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>anova_results <span class="op">=</span> {}</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> management_vars:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var <span class="kw">in</span> df.columns:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> df[[var, <span class="st">'SoilBD'</span>]].dropna()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp_df[var].nunique() <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span>  <span class="co"># Skip if only 1 group</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> ols(<span class="ss">f"SoilBD ~ C(</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">)"</span>, data<span class="op">=</span>temp_df).fit()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        anova_table <span class="op">=</span> anova_lm(model, typ<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        anova_results[var] <span class="op">=</span> anova_table</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ANOVA for SoilBD by </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(anova_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
ANOVA for SoilBD by CoverCropGroup:

                      sum_sq      df         F   PR(&gt;F)
C(CoverCropGroup)   1.307715    14.0  2.922223  0.00021
Residual           50.184713  1570.0       NaN      NaN

ANOVA for SoilBD by Tillage:

               sum_sq     df          F        PR(&gt;F)
C(Tillage)   1.349472    1.0  49.393287  5.046775e-12
Residual    18.824144  689.0        NaN           NaN

ANOVA for SoilBD by GrainCropGroup:

                      sum_sq      df          F        PR(&gt;F)
C(GrainCropGroup)   5.534108    16.0  11.821218  8.789639e-30
Residual           48.804678  1668.0        NaN           NaN</code></pre>
</div>
</div>
</section>
<section id="tukey-hsd-post-hoc-tests-for-significant-anovas" class="level2">
<h2 class="anchored" data-anchor-id="tukey-hsd-post-hoc-tests-for-significant-anovas">Tukey HSD Post Hoc Tests for Significant ANOVAs</h2>
<div id="53b89f4b-6395-4370-b756-a16273c4b02d" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.multicomp <span class="im">import</span> pairwise_tukeyhsd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>tukey_results <span class="op">=</span> {}</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> management_vars:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> var <span class="kw">in</span> df.columns:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> df[[var, <span class="st">'SoilBD'</span>]].dropna()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> temp_df[var].nunique() <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> ols(<span class="ss">f"SoilBD ~ C(</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">)"</span>, data<span class="op">=</span>temp_df).fit()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        anova_table <span class="op">=</span> anova_lm(model, typ<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> anova_table[<span class="st">'PR(&gt;F)'</span>][<span class="dv">0</span>]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p_value <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            tukey <span class="op">=</span> pairwise_tukeyhsd(endog<span class="op">=</span>temp_df[<span class="st">'SoilBD'</span>],</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                      groups<span class="op">=</span>temp_df[var],</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                                      alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            tukey_results[var] <span class="op">=</span> tukey.summary()</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Tukey HSD for </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(tukey.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Tukey HSD for CoverCropGroup:

       Multiple Comparison of Means - Tukey HSD, FWER=0.05       
=================================================================
    group1        group2    meandiff p-adj   lower  upper  reject
-----------------------------------------------------------------
          AVG            BG   -0.011    1.0   -0.43 0.4081  False
          AVG      Brassica   0.0445    1.0 -0.2053 0.2943  False
          AVG     Broadleaf   0.0757 0.9999 -0.2236  0.375  False
          AVG            GG  -0.0543    1.0 -0.7035 0.5949  False
          AVG         Grass  -0.0516    1.0 -0.2842 0.1809  False
          AVG            LG   0.0071    1.0 -0.2293 0.2435  False
          AVG            LL   0.0283    1.0 -0.2367 0.2934  False
          AVG        Legume   -0.022    1.0 -0.2527 0.2086  False
          AVG           MOT  -0.1068 0.9929  -0.382 0.1684  False
          AVG           MTT  -0.2543 0.9923 -0.9035 0.3949  False
          AVG         Mixed  -0.0457    1.0 -0.3006 0.2092  False
          AVG            No  -0.1186 0.9962 -0.4432  0.206  False
          AVG Not_available  -0.0243    1.0 -0.6735 0.6249  False
          AVG           Rye   0.0147    1.0 -0.2172 0.2465  False
           BG      Brassica   0.0555    1.0 -0.3087 0.4197  False
           BG     Broadleaf   0.0867    1.0 -0.3131 0.4864  False
           BG            GG  -0.0433    1.0 -0.7446 0.6579  False
           BG         Grass  -0.0407    1.0 -0.3933 0.3119  False
           BG            LG   0.0181    1.0 -0.3371 0.3732  False
           BG            LL   0.0393    1.0 -0.3355 0.4141  False
           BG        Legume  -0.0111    1.0 -0.3624 0.3402  False
           BG           MOT  -0.0958 0.9999 -0.4779 0.2862  False
           BG           MTT  -0.2433 0.9978 -0.9446 0.4579  False
           BG         Mixed  -0.0347    1.0 -0.4025  0.333  False
           BG            No  -0.1076 0.9999 -0.5267 0.3114  False
           BG Not_available  -0.0133    1.0 -0.7146 0.6879  False
           BG           Rye   0.0256    1.0 -0.3265 0.3777  False
     Brassica     Broadleaf   0.0312    1.0 -0.1846  0.247  False
     Brassica            GG  -0.0988    1.0  -0.714 0.5164  False
     Brassica         Grass  -0.0962  0.119 -0.2015 0.0092  False
     Brassica            LG  -0.0374 0.9987  -0.151 0.0762  False
     Brassica            LL  -0.0162    1.0 -0.1813 0.1489  False
     Brassica        Legume  -0.0666 0.6376 -0.1676 0.0345  False
     Brassica           MOT  -0.1513 0.2267 -0.3323 0.0297  False
     Brassica           MTT  -0.2988 0.9472  -0.914 0.3164  False
     Brassica         Mixed  -0.0902 0.7575 -0.2385 0.0581  False
     Brassica            No  -0.1631 0.6519 -0.4129 0.0867  False
     Brassica Not_available  -0.0688    1.0  -0.684 0.5464  False
     Brassica           Rye  -0.0299 0.9997 -0.1336 0.0739  False
    Broadleaf            GG    -0.13    1.0 -0.7669 0.5069  False
    Broadleaf         Grass  -0.1274 0.6569  -0.323 0.0683  False
    Broadleaf            LG  -0.0686  0.998 -0.2688 0.1316  False
    Broadleaf            LL  -0.0474    1.0 -0.2807 0.1859  False
    Broadleaf        Legume  -0.0978 0.9279 -0.2911 0.0956  False
    Broadleaf           MOT  -0.1825 0.4177 -0.4273 0.0623  False
    Broadleaf           MTT    -0.33 0.9135 -0.9669 0.3069  False
    Broadleaf         Mixed  -0.1214 0.8727 -0.3432 0.1004  False
    Broadleaf            No  -0.1943 0.6612 -0.4936  0.105  False
    Broadleaf Not_available     -0.1    1.0 -0.7369 0.5369  False
    Broadleaf           Rye  -0.0611 0.9993 -0.2558 0.1337  False
           GG         Grass   0.0026    1.0 -0.6058 0.6111  False
           GG            LG   0.0614    1.0 -0.5485 0.6713  False
           GG            LL   0.0826    1.0  -0.539 0.7042  False
           GG        Legume   0.0322    1.0 -0.5755 0.6399  False
           GG           MOT  -0.0525    1.0 -0.6785 0.5735  False
           GG           MTT     -0.2    1.0 -1.0588 0.6588  False
           GG         Mixed   0.0086    1.0 -0.6087 0.6259  False
           GG            No  -0.0643    1.0 -0.7135 0.5849  False
           GG Not_available     0.03    1.0 -0.8288 0.8888  False
           GG           Rye   0.0689    1.0 -0.5392 0.6771  False
        Grass            LG   0.0587 0.1788 -0.0091 0.1266  False
        Grass            LL     0.08 0.8143 -0.0577 0.2177  False
        Grass        Legume   0.0296 0.5899 -0.0141 0.0733  False
        Grass           MOT  -0.0551 0.9973 -0.2115 0.1012  False
        Grass           MTT  -0.2026 0.9986 -0.8111 0.4058  False
        Grass         Mixed    0.006    1.0 -0.1111  0.123  False
        Grass            No  -0.0669 0.9997 -0.2995 0.1656  False
        Grass Not_available   0.0274    1.0 -0.5811 0.6358  False
        Grass           Rye   0.0663 0.0006  0.0168 0.1158   True
           LG            LL   0.0212    1.0 -0.1229 0.1653  False
           LG        Legume  -0.0292 0.9534 -0.0901 0.0318  False
           LG           MOT  -0.1139 0.5245 -0.2759 0.0481  False
           LG           MTT  -0.2614 0.9819 -0.8713 0.3485  False
           LG         Mixed  -0.0528 0.9836 -0.1773 0.0717  False
           LG            No  -0.1257  0.896 -0.3621 0.1107  False
           LG Not_available  -0.0314    1.0 -0.6413 0.5785  False
           LG           Rye   0.0076    1.0 -0.0577 0.0728  False
           LL        Legume  -0.0504  0.995 -0.1848 0.0841  False
           LL           MOT  -0.1351 0.6076 -0.3366 0.0664  False
           LL           MTT  -0.2826 0.9694 -0.9042  0.339  False
           LL         Mixed   -0.074  0.982 -0.2468 0.0988  False
           LL            No  -0.1469 0.8618 -0.4119 0.1181  False
           LL Not_available  -0.0526    1.0 -0.6742  0.569  False
           LL           Rye  -0.0137    1.0 -0.1501 0.1228  False
       Legume           MOT  -0.0847 0.8654 -0.2382 0.0688  False
       Legume           MTT  -0.2322 0.9939 -0.8399 0.3755  False
       Legume         Mixed  -0.0236    1.0 -0.1368 0.0895  False
       Legume            No  -0.0965 0.9854 -0.3272 0.1341  False
       Legume Not_available  -0.0022    1.0 -0.6099 0.6055  False
       Legume           Rye   0.0367  0.104 -0.0029 0.0763  False
          MOT           MTT  -0.1475    1.0 -0.7735 0.4785  False
          MOT         Mixed   0.0611 0.9989 -0.1269 0.2491  False
          MOT            No  -0.0118    1.0  -0.287 0.2634  False
          MOT Not_available   0.0825    1.0 -0.5435 0.7085  False
          MOT           Rye   0.1214 0.3328 -0.0338 0.2767  False
          MTT         Mixed   0.2086 0.9983 -0.4087 0.8259  False
          MTT            No   0.1357    1.0 -0.5135 0.7849  False
          MTT Not_available     0.23 0.9999 -0.6288 1.0888  False
          MTT           Rye   0.2689  0.976 -0.3392 0.8771  False
        Mixed            No  -0.0729 0.9997 -0.3278  0.182  False
        Mixed Not_available   0.0214    1.0 -0.5959 0.6387  False
        Mixed           Rye   0.0603 0.9083 -0.0552 0.1759  False
           No Not_available   0.0943    1.0 -0.5549 0.7435  False
           No           Rye   0.1332 0.8259 -0.0986 0.3651  False
Not_available           Rye   0.0389    1.0 -0.5692 0.6471  False
-----------------------------------------------------------------

Tukey HSD for Tillage:

Multiple Comparison of Means - Tukey HSD, FWER=0.05
===================================================
group1 group2 meandiff p-adj  lower   upper  reject
---------------------------------------------------
    CT     NT  -0.0884   0.0 -0.1131 -0.0637   True
---------------------------------------------------

Tukey HSD for GrainCropGroup:

   Multiple Comparison of Means - Tukey HSD, FWER=0.05    
==========================================================
  group1    group2  meandiff p-adj   lower   upper  reject
----------------------------------------------------------
      AVG    Arable   0.0425 0.9871 -0.0556  0.1407  False
      AVG        CO   0.0898 0.7657 -0.0554  0.2351  False
      AVG        CS   0.0349 0.9993  -0.069  0.1387  False
      AVG       CSW   0.0722 0.9007 -0.0603  0.2047  False
      AVG        CV   0.0681 0.8539 -0.0504  0.1866  False
      AVG        CW   0.0931 0.9663 -0.1014  0.2876  False
      AVG      Corn   0.0049    1.0 -0.0926  0.1025  False
      AVG       MTT   0.0776 0.9999 -0.2031  0.3583  False
      AVG     Maize  -0.0894 0.9999 -0.3998   0.221  False
      AVG   Orchard  -0.1219 0.0125 -0.2311 -0.0126   True
      AVG     Other  -0.1094 0.9987 -0.4198   0.201  False
      AVG   Pasture  -0.2644 0.4386 -0.6188    0.09  False
      AVG   Soybean  -0.0605 0.9266 -0.1758  0.0549  False
      AVG Vegetable   0.0698 0.5754 -0.0308  0.1705  False
      AVG        WO   0.2122    0.0  0.0724  0.3519   True
      AVG     Wheat   0.0504 0.9539 -0.0513  0.1522  False
   Arable        CO   0.0473 0.9936 -0.0694  0.1639  False
   Arable        CS  -0.0077    1.0 -0.0651  0.0497  False
   Arable       CSW   0.0297 0.9999 -0.0707    0.13  False
   Arable        CV   0.0256 0.9997 -0.0554  0.1065  False
   Arable        CW   0.0506 0.9999 -0.1236  0.2247  False
   Arable      Corn  -0.0376 0.2381 -0.0826  0.0074  False
   Arable       MTT   0.0351    1.0 -0.2319  0.3021  False
   Arable     Maize  -0.1319 0.9841   -0.43  0.1661  False
   Arable   Orchard  -0.1644    0.0 -0.2311 -0.0977   True
   Arable     Other  -0.1519 0.9417   -0.45  0.1461  False
   Arable   Pasture  -0.3069 0.1463 -0.6506  0.0367  False
   Arable   Soybean   -0.103 0.0004 -0.1793 -0.0267   True
   Arable Vegetable   0.0273 0.9175  -0.024  0.0786  False
   Arable        WO   0.1696    0.0  0.0599  0.2794   True
   Arable     Wheat   0.0079    1.0 -0.0455  0.0613  False
       CO        CS  -0.0549 0.9804 -0.1764  0.0665  False
       CO       CSW  -0.0176    1.0 -0.1644  0.1291  False
       CO        CV  -0.0217    1.0  -0.156  0.1125  False
       CO        CW   0.0033    1.0 -0.2011  0.2077  False
       CO      Corn  -0.0849 0.4778 -0.2011  0.0313  False
       CO       MTT  -0.0122    1.0 -0.2999  0.2754  False
       CO     Maize  -0.1792 0.8687 -0.4959  0.1375  False
       CO   Orchard  -0.2117    0.0 -0.3378 -0.0855   True
       CO     Other  -0.1992 0.7413 -0.5159  0.1175  False
       CO   Pasture  -0.3542 0.0595 -0.7142  0.0057  False
       CO   Soybean  -0.1503 0.0087 -0.2817 -0.0188   True
       CO Vegetable    -0.02    1.0 -0.1387  0.0988  False
       CO        WO   0.1224 0.3141  -0.031  0.2757  False
       CO     Wheat  -0.0394 0.9994  -0.159  0.0803  False
       CS       CSW   0.0373 0.9987 -0.0686  0.1433  False
       CS        CV   0.0332  0.997 -0.0546   0.121  False
       CS        CW   0.0582 0.9995 -0.1192  0.2356  False
       CS      Corn    -0.03  0.918 -0.0863  0.0264  False
       CS       MTT   0.0427    1.0 -0.2264  0.3119  False
       CS     Maize  -0.1243  0.992 -0.4242  0.1757  False
       CS   Orchard  -0.1567    0.0 -0.2316 -0.0819   True
       CS     Other  -0.1443 0.9649 -0.4442  0.1557  False
       CS   Pasture  -0.2993 0.1846 -0.6446   0.046  False
       CS   Soybean  -0.0953 0.0088 -0.1788 -0.0119   True
       CS Vegetable    0.035 0.8643 -0.0265  0.0965  False
       CS        WO   0.1773    0.0  0.0624  0.2922   True
       CS     Wheat   0.0156    1.0 -0.0477  0.0788  False
      CSW        CV  -0.0041    1.0 -0.1245  0.1163  False
      CSW        CW   0.0209    1.0 -0.1747  0.2165  False
      CSW      Corn  -0.0673  0.628 -0.1671  0.0325  False
      CSW       MTT   0.0054    1.0  -0.276  0.2869  False
      CSW     Maize  -0.1616 0.9318 -0.4727  0.1495  False
      CSW   Orchard  -0.1941    0.0 -0.3053 -0.0828   True
      CSW     Other  -0.1816 0.8372 -0.4927  0.1295  False
      CSW   Pasture  -0.3366 0.0865 -0.6916  0.0184  False
      CSW   Soybean  -0.1327 0.0101 -0.2499 -0.0154   True
      CSW Vegetable  -0.0024    1.0 -0.1051  0.1004  False
      CSW        WO     0.14 0.0555 -0.0013  0.2813  False
      CSW     Wheat  -0.0218    1.0 -0.1256  0.0821  False
       CV        CW    0.025    1.0 -0.1614  0.2114  False
       CV      Corn  -0.0632 0.3383 -0.1434  0.0171  False
       CV       MTT   0.0095    1.0 -0.2656  0.2846  False
       CV     Maize  -0.1575 0.9357 -0.4629  0.1479  False
       CV   Orchard    -0.19    0.0 -0.2841 -0.0958   True
       CV     Other  -0.1775 0.8419 -0.4829  0.1279  False
       CV   Pasture  -0.3325 0.0849 -0.6825  0.0175  False
       CV   Soybean  -0.1286 0.0014 -0.2297 -0.0274   True
       CV Vegetable   0.0017    1.0 -0.0822  0.0857  False
       CV        WO   0.1441 0.0113  0.0158  0.2724   True
       CV     Wheat  -0.0177    1.0 -0.1029  0.0676  False
       CW      Corn  -0.0882 0.9439  -0.262  0.0856  False
       CW       MTT  -0.0155    1.0 -0.3309  0.2999  False
       CW     Maize  -0.1825 0.9155 -0.5246  0.1596  False
       CW   Orchard   -0.215 0.0045 -0.3956 -0.0343   True
       CW     Other  -0.2025 0.8215 -0.5446  0.1396  False
       CW   Pasture  -0.3575 0.0989   -0.74   0.025  False
       CW   Soybean  -0.1536 0.2429  -0.338  0.0308  False
       CW Vegetable  -0.0233    1.0 -0.1988  0.1523  False
       CW        WO   0.1191  0.818 -0.0815  0.3196  False
       CW     Wheat  -0.0427    1.0 -0.2188  0.1335  False
     Corn       MTT   0.0727    1.0 -0.1941  0.3395  False
     Corn     Maize  -0.0943 0.9997 -0.3922  0.2035  False
     Corn   Orchard  -0.1268    0.0 -0.1926  -0.061   True
     Corn     Other  -0.1143 0.9965 -0.4122  0.1835  False
     Corn   Pasture  -0.2693 0.3456 -0.6128  0.0742  False
     Corn   Soybean  -0.0654 0.1853 -0.1409  0.0101  False
     Corn Vegetable   0.0649  0.001  0.0148  0.1151   True
     Corn        WO   0.2073    0.0  0.0981  0.3165   True
     Corn     Wheat   0.0455 0.1789 -0.0068  0.0978  False
      MTT     Maize   -0.167 0.9907 -0.5645  0.2305  False
      MTT   Orchard  -0.1995 0.4663 -0.4707  0.0718  False
      MTT     Other   -0.187 0.9714 -0.5845  0.2105  False
      MTT   Pasture   -0.342 0.3312 -0.7747  0.0907  False
      MTT   Soybean  -0.1381 0.9467 -0.4119  0.1357  False
      MTT Vegetable  -0.0078    1.0 -0.2757  0.2601  False
      MTT        WO   0.1346 0.9703 -0.1504  0.4195  False
      MTT     Wheat  -0.0272    1.0 -0.2955  0.2412  False
    Maize   Orchard  -0.0325    1.0 -0.3344  0.2694  False
    Maize     Other    -0.02    1.0  -0.439   0.399  False
    Maize   Pasture   -0.175 0.9962 -0.6275  0.2775  False
    Maize   Soybean   0.0289    1.0 -0.2752  0.3331  False
    Maize Vegetable   0.1592 0.9164 -0.1396  0.4581  False
    Maize        WO   0.3016 0.0768 -0.0126  0.6158  False
    Maize     Wheat   0.1398 0.9731 -0.1594  0.4391  False
  Orchard     Other   0.0125    1.0 -0.2894  0.3144  False
  Orchard   Pasture  -0.1425 0.9927 -0.4895  0.2045  False
  Orchard   Soybean   0.0614 0.6091 -0.0287  0.1515  False
  Orchard Vegetable   0.1917    0.0  0.1215   0.262   True
  Orchard        WO   0.3341    0.0  0.2143  0.4538   True
  Orchard     Wheat   0.1723    0.0  0.1005  0.2441   True
    Other   Pasture   -0.155 0.9991 -0.6075  0.2975  False
    Other   Soybean   0.0489    1.0 -0.2552  0.3531  False
    Other Vegetable   0.1792 0.8059 -0.1196  0.4781  False
    Other        WO   0.3216 0.0384  0.0074  0.6358   True
    Other     Wheat   0.1598 0.9147 -0.1394  0.4591  False
  Pasture   Soybean   0.2039  0.836  -0.145  0.5529  False
  Pasture Vegetable   0.3342 0.0686 -0.0101  0.6786  False
  Pasture        WO   0.4766 0.0005  0.1188  0.8343   True
  Pasture     Wheat   0.3148 0.1214 -0.0298  0.6595  False
  Soybean Vegetable   0.1303    0.0  0.0509  0.2097   True
  Soybean        WO   0.2726    0.0  0.1473   0.398   True
  Soybean     Wheat   0.1109 0.0003  0.0301  0.1917   True
Vegetable        WO   0.1423 0.0014  0.0304  0.2543   True
Vegetable     Wheat  -0.0194 0.9993 -0.0772  0.0384  False
       WO     Wheat  -0.1617 0.0001 -0.2747 -0.0488   True
----------------------------------------------------------</code></pre>
</div>
</div>
<div id="6bcb56cd-9959-4dd2-9ddd-4598f52654bb" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> tukey_results.keys():</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    temp_df <span class="op">=</span> df[[var, <span class="st">'SoilBD'</span>]].dropna()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(data<span class="op">=</span>temp_df, x<span class="op">=</span>var, y<span class="op">=</span><span class="st">'SoilBD'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Tukey HSD - SoilBD by </span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="question1_v1_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="question1_v1_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="question1_v1_files/figure-html/cell-7-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="stratified-anova-and-boxplots-by-country" class="level2">
<h2 class="anchored" data-anchor-id="stratified-anova-and-boxplots-by-country">Stratified ANOVA and Boxplots by Country</h2>
<div id="7b6fff9a-c531-4494-aab9-0182f3bff3e2" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.anova <span class="im">import</span> anova_lm</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace this with the actual path if needed</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># df = pd.read_excel("SoilHealthDB_V2.xlsx")</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'Country' and all management_vars exist and are clean</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>management_vars <span class="op">=</span> [<span class="st">'CoverCropGroup'</span>, <span class="st">'Tillage'</span>, <span class="st">'Rotation'</span>, <span class="st">'GrainCropGroup'</span>, <span class="st">'Grazing'</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> df[<span class="st">'Country'</span>].dropna().unique()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country <span class="kw">in</span> countries:</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    df_country <span class="op">=</span> df[df[<span class="st">'Country'</span>] <span class="op">==</span> country]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> management_vars:</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> var <span class="kw">in</span> df_country.columns:</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            temp_df <span class="op">=</span> df_country[[<span class="st">'SoilBD'</span>, var]].dropna()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> temp_df[var].nunique() <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span>  <span class="co"># Skip if only one category present</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                model <span class="op">=</span> ols(<span class="ss">f'SoilBD ~ C(</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss">)'</span>, data<span class="op">=</span>temp_df).fit()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                anova_table <span class="op">=</span> anova_lm(model, typ<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                f_stat <span class="op">=</span> anova_table[<span class="st">'F'</span>][<span class="dv">0</span>]</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                p_value <span class="op">=</span> anova_table[<span class="st">'PR(&gt;F)'</span>][<span class="dv">0</span>]</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                results.append({</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Country'</span>: country,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'ManagementVariable'</span>: var,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'F-Statistic'</span>: <span class="bu">round</span>(f_stat, <span class="dv">2</span>),</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'p-Value'</span>: <span class="bu">round</span>(p_value, <span class="dv">4</span>),</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Significant'</span>: <span class="st">'Yes'</span> <span class="cf">if</span> p_value <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">'No'</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span>  <span class="co"># Skip any models that error</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create summary table</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>anova_summary_table <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(anova_summary_table)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, export to Excel or CSV</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># anova_summary_table.to_csv("anova_summary_by_country.csv", index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
File <span class="ansi-green-fg">/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/core/indexes/base.py:3805</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3804</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; 3805</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_engine</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">casted_key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   3806</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

File <span class="ansi-green-fg">index.pyx:167</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">index.pyx:196</span>, in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7081</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi:7089</span>, in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: 'Country'

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[37], line 10</span>
<span class="ansi-green-fg ansi-bold">      5</span> <span style="font-style:italic;color:rgb(95,135,135)"># Replace this with the actual path if needed</span>
<span class="ansi-green-fg ansi-bold">      6</span> <span style="font-style:italic;color:rgb(95,135,135)"># df = pd.read_excel("SoilHealthDB_V2.xlsx")</span>
<span class="ansi-green-fg ansi-bold">      7</span> 
<span class="ansi-green-fg ansi-bold">      8</span> <span style="font-style:italic;color:rgb(95,135,135)"># Ensure 'Country' and all management_vars exist and are clean</span>
<span class="ansi-green-fg ansi-bold">      9</span> management_vars <span style="color:rgb(98,98,98)">=</span> [<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">CoverCropGroup</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Tillage</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Rotation</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">GrainCropGroup</span><span style="color:rgb(175,0,0)">'</span>, <span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">Grazing</span><span style="color:rgb(175,0,0)">'</span>]
<span class="ansi-green-fg">---&gt; 10</span> countries <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">df</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">Country</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span style="color:rgb(98,98,98)">.</span>dropna()<span style="color:rgb(98,98,98)">.</span>unique()
<span class="ansi-green-fg ansi-bold">     12</span> results <span style="color:rgb(98,98,98)">=</span> []
<span class="ansi-green-fg ansi-bold">     14</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> country <span style="font-weight:bold;color:rgb(175,0,255)">in</span> countries:

File <span class="ansi-green-fg">/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/core/frame.py:4102</span>, in <span class="ansi-cyan-fg">DataFrame.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   4100</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels <span style="color:rgb(98,98,98)">&gt;</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg ansi-bold">   4101</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_getitem_multilevel(key)
<span class="ansi-green-fg">-&gt; 4102</span> indexer <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">columns</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">get_loc</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   4103</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_integer(indexer):
<span class="ansi-green-fg ansi-bold">   4104</span>     indexer <span style="color:rgb(98,98,98)">=</span> [indexer]

File <span class="ansi-green-fg">/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pandas/core/indexes/base.py:3812</span>, in <span class="ansi-cyan-fg">Index.get_loc</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg ansi-bold">   3807</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(175,0,255)">or</span> (
<span class="ansi-green-fg ansi-bold">   3808</span>         <span style="color:rgb(0,135,0)">isinstance</span>(casted_key, abc<span style="color:rgb(98,98,98)">.</span>Iterable)
<span class="ansi-green-fg ansi-bold">   3809</span>         <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">any</span>(<span style="color:rgb(0,135,0)">isinstance</span>(x, <span style="color:rgb(0,135,0)">slice</span>) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> x <span style="font-weight:bold;color:rgb(175,0,255)">in</span> casted_key)
<span class="ansi-green-fg ansi-bold">   3810</span>     ):
<span class="ansi-green-fg ansi-bold">   3811</span>         <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> InvalidIndexError(key)
<span class="ansi-green-fg">-&gt; 3812</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>(key) <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">err</span>
<span class="ansi-green-fg ansi-bold">   3813</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   3814</span>     <span style="font-style:italic;color:rgb(95,135,135)"># If we have a listlike key, _check_indexing_error will raise</span>
<span class="ansi-green-fg ansi-bold">   3815</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  InvalidIndexError. Otherwise we fall through and re-raise</span>
<span class="ansi-green-fg ansi-bold">   3816</span>     <span style="font-style:italic;color:rgb(95,135,135)">#  the TypeError.</span>
<span class="ansi-green-fg ansi-bold">   3817</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_check_indexing_error(key)

<span class="ansi-red-fg">KeyError</span>: 'Country'</pre>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>